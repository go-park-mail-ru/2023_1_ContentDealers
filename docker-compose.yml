version: '3'

# для обновления скрипта иницилазиции бд postgres
# sudo rm -rf temp_db_data/pgdata/* && sudo docker compose up

# docker compose config - подставляет переменные окружения из .env в ${POSTGRES_PASSWORD} и показывает итоговый конфиг 

services:
  postgres:
    image: postgres
    restart: always
    environment: 
      - PGDATA=/var/lib/postgresql/data/pgdata
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    logging:
      options:
        max-size: 10m
        max-file: "3"
    ports:
      - '5432:5432'
    volumes:
      # данные бд
      - ./tmp_persist:/var/lib/postgresql/data
      # скрипт для инициализации бд 
      - ./scripts/db.sql:/docker-entrypoint-initdb.d/db.sql
  adminer:
    image: adminer
    restart: always
    links:
        - "postgres:postgres"
    ports:
      - 8090:8080
  redis:
    image: 'redis'
    volumes:
      - ./tmp_persist/redis_data:/data
    ports:
      - '6379:6379'
